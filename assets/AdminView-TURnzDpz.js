import{f as i,y as xe,i as De,c as r,b as t,j as g,q as N,z as k,A as Fe,t as m,n as Ie,F as I,k as _,B,e as _e,o as u,p as Ve}from"./index-IP7uLuLc.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const E="https://api.github.com/repos/OUTshipping/OUTshipping.github.io",J="source",G="main";function U(f){return{Authorization:`Bearer ${f}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"}}async function Te(f){try{const d=await fetch(`${E}`,{headers:U(f)});if(!d.ok)return{valid:!1,message:"无效的 Token 或无权访问此仓库"};const c=await d.json();return!c.permissions||!c.permissions.push?{valid:!1,message:"Token 没有对此仓库的写入权限"}:{valid:!0,message:"验证成功"}}catch(d){return{valid:!1,message:`网络错误: ${d.message}`}}}async function te(f,d){const c=await fetch(`${E}/contents/${d}?ref=${J}`,{headers:U(f)});if(!c.ok)throw new Error(`获取文件失败: ${c.status} ${c.statusText}`);const h=await c.json();return{content:decodeURIComponent(escape(atob(h.content.replace(/\n/g,"")))),sha:h.sha}}async function ae(f,d,c,h,v){const p=await fetch(`${E}/contents/${d}`,{method:"PUT",headers:U(f),body:JSON.stringify({message:v,content:btoa(unescape(encodeURIComponent(c))),sha:h,branch:J})});if(!p.ok){const o=await p.json();throw new Error(`更新文件失败: ${o.message||JSON.stringify(o)}`)}return await p.json()}async function ne(f,d,c,h){const v=await fetch(`${E}/contents/${d}`,{method:"PUT",headers:U(f),body:JSON.stringify({message:h,content:c,branch:J})});if(!v.ok){const o=await v.json();throw new Error(`上传图片失败: ${o.message||JSON.stringify(o)}`)}const p=await v.json();if(d.startsWith("public/")){const o=d.replace(/^public\//,"");try{let y;const w=await fetch(`${E}/contents/${o}?ref=${G}`,{headers:U(f)});w.ok&&(y=(await w.json()).sha);const S={message:`deploy: ${h}`,content:c,branch:G};y&&(S.sha=y),await fetch(`${E}/contents/${o}`,{method:"PUT",headers:U(f),body:JSON.stringify(S)})}catch(y){console.warn("图片同步到 main 分支失败:",y)}}return p}async function Ne(f){const d=await fetch(`${E}/contents/public/data/vehicles.json?ref=${J}`,{headers:U(f)});if(!d.ok)throw new Error(`读取 source 分支数据失败: ${d.status} ${d.statusText}`);const h=(await d.json()).content.replace(/\n/g,""),v=await fetch(`${E}/contents/data/vehicles.json?ref=${G}`,{headers:U(f)});if(!v.ok)throw new Error(`读取 main 分支数据失败: ${v.status} ${v.statusText}`);const o=(await v.json()).sha,y=await fetch(`${E}/contents/data/vehicles.json`,{method:"PUT",headers:U(f),body:JSON.stringify({message:"deploy: sync vehicles data to live site",content:h,sha:o,branch:G})});if(!y.ok){const w=await y.json();throw new Error(`部署到 main 失败: ${w.message||JSON.stringify(w)}`)}return await y.json()}const Be={class:"admin-page"},Re={key:0,class:"login-container"},je={class:"login-card"},Pe={class:"login-form"},Le=["disabled"],Oe={key:0,class:"error-msg"},Me={key:1,class:"admin-container"},Ge={class:"admin-header"},Je={class:"header-actions"},He=["disabled"],Ke={key:1,class:"vehicle-list"},ze={class:"list-header"},Ye=["disabled"],We={class:"vehicle-table"},qe=["src","alt"],Qe={class:"switch"},Xe=["checked","onChange"],Ze={class:"actions-cell"},et=["onClick"],tt=["onClick"],at={key:2,class:"form-container"},nt={key:0,class:"db-selector-card"},st={class:"db-selector-row"},lt={class:"db-selector-group"},ot=["value"],it={class:"db-selector-group"},rt=["disabled"],ut=["value"],dt={class:"db-selector-group"},ct=["disabled"],pt=["value"],mt=["disabled"],vt={key:1,class:"db-selector-card"},gt={class:"form-grid"},ft={class:"form-group"},ht={class:"form-group"},yt={class:"form-group"},bt={class:"form-group"},wt={class:"form-group"},Ct={class:"form-group"},kt={class:"form-group full-width"},St={class:"form-grid"},$t={class:"form-group"},Et={class:"form-group"},Ut={class:"form-group"},xt={class:"form-group"},Dt={class:"form-group"},Ft={class:"colors-editor"},It=["onClick"],_t={class:"color-add-row"},Vt=["value"],At=["disabled"],Tt={class:"image-upload-section"},Nt={key:0,class:"current-cover"},Bt=["src"],Rt={class:"image-upload-section"},jt={class:"detail-images-grid"},Pt=["src"],Lt=["onClick"],Ot={class:"form-actions"},Mt=["disabled"],Gt={__name:"AdminView",setup(f){const d=i(!1),c=i(""),h=i(!1),v=i("");let p="";const o=i([]),y=i(!1),w=i(""),S=i(!1),x=i(!1),j=i(null),P=i(!1),L=i(!1),se=i(null),le=i(null),O=i(""),Y=i("info"),D=i(null),$=i([]),W=[{name:"White",hex:"#FFFFFF"},{name:"Black",hex:"#000000"},{name:"Silver",hex:"#C0C0C0"},{name:"Gray",hex:"#808080"},{name:"Light Gray",hex:"#D3D3D3"},{name:"Red",hex:"#FF0000"},{name:"Dark Red",hex:"#8B0000"},{name:"Blue",hex:"#0000FF"},{name:"Dark Blue",hex:"#00008B"},{name:"Navy Blue",hex:"#0011FF"},{name:"Green",hex:"#008000"},{name:"Dark Green",hex:"#006400"},{name:"Yellow",hex:"#FFD700"},{name:"Orange",hex:"#FF8C00"},{name:"Brown",hex:"#8B4513"},{name:"Beige",hex:"#F5F5DC"},{name:"Champagne",hex:"#F7E7CE"},{name:"Pearl",hex:"#FDEEF4"},{name:"Coral",hex:"#FF6B6B"},{name:"Teal",hex:"#4ECDC4"},{name:"Lemon",hex:"#FFE66D"}];function oe(n){const e=W.find(a=>a.hex.toUpperCase()===n.toUpperCase());return e?e.name:n}function ie(){const n=s.colors.map(e=>e.toUpperCase());return W.filter(e=>!n.includes(e.hex.toUpperCase()))}function re(){V.value&&(s.colors.push(V.value),V.value="")}const V=i(""),A=i([]),H=i(!1),R=i(""),T=i(""),F=i("");function q(){const n=A.value.find(e=>e.nameEn===R.value);return n?n.models:[]}function ue(){const e=q().find(a=>a.nameEn===T.value);return e?e.variants:[]}function de(){T.value="",F.value=""}function ce(){F.value=""}function pe(){if(!F.value)return;const n=A.value.find(l=>l.nameEn===R.value);if(!n)return;const e=n.models.find(l=>l.nameEn===T.value);if(!e)return;const a=e.variants.find(l=>l.specNameEn===F.value);a&&(s.name=`${a.year} ${n.nameEn} ${e.nameEn}`,s.slug=me(s.name),s.type=a.type||"SUV",s.range=a.range||0,s.seats=a.seats||5,s.specs.year=a.year||"2025",s.specs.make=n.nameEn,s.specs.model=e.nameEn,s.specs.batteryCapacity=a.batteryCapacity||"N/A",s.specs.category="PASSENGER",C("Auto-filled from database: "+s.name,"success"))}async function Q(){H.value=!0;try{const e=await fetch("https://raw.githubusercontent.com/OUTshipping/OUTshipping.github.io/source/public/data/brands.json");if(e.ok){const a=await e.json();A.value=a.brands||[],console.log(`Loaded ${A.value.length} brands from database`)}}catch(n){console.warn("Failed to load brands database:",n)}finally{H.value=!1}}const X=()=>({name:"",slug:"",type:"SUV",range:0,seats:5,configuration:"Basic",description:"",coverImage:"",colors:["#000000"],specs:{year:"2025",make:"",model:"",category:"",batteryCapacity:"N/A"},detailImages:[]}),s=xe(X());function me(n){return n.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}async function Z(){h.value=!0,v.value="";try{const n=await Te(c.value);n.valid?(p=c.value,d.value=!0,sessionStorage.setItem("gh_token",p),await K(),Q()):v.value=n.message}catch(n){v.value=n.message}finally{h.value=!1}}function ve(){d.value=!1,p="",sessionStorage.removeItem("gh_token"),o.value=[]}async function K(){y.value=!0;try{const{content:n,sha:e}=await te(p,"public/data/vehicles.json");o.value=JSON.parse(n),w.value=e}catch(n){C("Failed to load vehicles: "+n.message,"error")}finally{y.value=!1}}async function ge(n){n.enabled=!n.enabled,await z("Toggle vehicle: "+n.name)}function fe(){Object.assign(s,X()),D.value=null,$.value=[],x.value=!1,j.value=null,S.value=!0}function he(n){Object.assign(s,{name:n.name,slug:n.slug,type:n.type,range:n.range,seats:n.seats,configuration:n.configuration,description:n.description,coverImage:n.coverImage,colors:[...n.colors],specs:{...n.specs},detailImages:[...n.detailImages]}),D.value=null,$.value=[],x.value=!0,j.value=n.id,S.value=!0}function ye(){S.value=!1}function be(n){const e=n.target.files[0];if(!e)return;D.value=e;const a=new FileReader;a.onload=l=>{s.coverImage=l.target.result},a.readAsDataURL(e)}function we(n){Array.from(n.target.files).forEach(a=>{$.value.push(a);const l=new FileReader;l.onload=b=>{s.detailImages.push(b.target.result)},l.readAsDataURL(a)})}function Ce(n){s.detailImages.splice(n,1),n<$.value.length&&$.value.splice(n,1)}function ee(n){return new Promise((e,a)=>{const l=new FileReader;l.onload=()=>{const b=l.result.split(",")[1];e(b)},l.onerror=a,l.readAsDataURL(n)})}function C(n,e="info"){O.value=n,Y.value=e,setTimeout(()=>{O.value=""},5e3)}async function ke(n){confirm(`Are you sure you want to delete "${n.name}"?`)&&(o.value=o.value.filter(e=>e.id!==n.id),await z("Delete vehicle: "+n.name))}async function z(n){try{const e=JSON.stringify(o.value,null,2),a=await ae(p,"public/data/vehicles.json",e,w.value,n);w.value=a.content.sha,C("Saved successfully! Site will update in 1-2 minutes.","success")}catch(e){if(e.message&&e.message.includes("does not match"))try{C("SHA mismatch, retrying...","info");const{sha:a}=await te(p,"public/data/vehicles.json");w.value=a;const l=JSON.stringify(o.value,null,2),b=await ae(p,"public/data/vehicles.json",l,w.value,n);w.value=b.content.sha,C("Saved successfully! Site will update in 1-2 minutes.","success")}catch(a){C("Save failed after retry: "+a.message,"error")}else C("Save failed: "+e.message,"error")}}async function Se(){if(confirm("确认将当前数据部署到前台网站？")){L.value=!0;try{await Ne(p),C("Deployed successfully! Live site will update in ~1 minute.","success")}catch(n){C("Deploy failed: "+n.message,"error")}finally{L.value=!1}}}async function $e(){if(!s.name||!s.slug||!s.type){C("Please fill in all required fields.","error");return}P.value=!0;try{const n=s.slug;if(D.value){const l=D.value.name.split(".").pop(),b=`public/vehicles/${n}/cover.${l}`,M=await ee(D.value);await ne(p,b,M,`Upload cover for ${s.name}`),s.coverImage=`/vehicles/${n}/cover.${l}`}const e=s.detailImages.length-$.value.length;for(let l=0;l<$.value.length;l++){const b=$.value[l],M=b.name.split(".").pop(),Ee=`public/vehicles/${n}/${e+l+1}.${M}`,Ue=await ee(b);await ne(p,Ee,Ue,`Upload image for ${s.name}`),s.detailImages[e+l]=`/vehicles/${n}/${e+l+1}.${M}`}const a={id:x.value?j.value:Math.max(0,...o.value.map(l=>l.id))+1,slug:s.slug,enabled:!0,name:s.name,type:s.type,range:s.range,seats:s.seats,configuration:s.configuration,coverImage:s.coverImage,colors:[...s.colors],description:s.description,specs:{...s.specs},detailImages:[...s.detailImages]};if(x.value){const l=o.value.findIndex(b=>b.id===j.value);l!==-1&&(a.enabled=o.value[l].enabled,o.value[l]=a)}else o.value.push(a);await z(x.value?`Update vehicle: ${s.name}`:`Add vehicle: ${s.name}`),S.value=!1,D.value=null,$.value=[]}catch(n){C("Save failed: "+n.message,"error")}finally{P.value=!1}}return De(()=>{const n=sessionStorage.getItem("gh_token");n&&(p=n,d.value=!0,K(),Q())}),(n,e)=>(u(),r("div",Be,[d.value?(u(),r("div",Me,[t("header",Ge,[e[19]||(e[19]=t("h1",null,"Vehicle Management",-1)),t("div",Je,[t("button",{class:"btn-add",onClick:fe},"+ Add Vehicle"),t("button",{class:"btn-deploy",onClick:Se,disabled:L.value},m(L.value?"Deploying...":"Deploy to Live Site"),9,He),t("button",{class:"btn-logout",onClick:ve},"Logout")])]),O.value?(u(),r("div",{key:0,class:Ie(["status-bar",Y.value])},m(O.value),3)):N("",!0),S.value?N("",!0):(u(),r("div",Ke,[t("div",ze,[t("span",null,"Total: "+m(o.value.length)+" vehicles",1),t("button",{class:"btn-refresh",onClick:K,disabled:y.value},m(y.value?"Loading...":"Refresh"),9,Ye)]),t("table",We,[e[21]||(e[21]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Image"),t("th",null,"Name"),t("th",null,"Type"),t("th",null,"Range"),t("th",null,"Status"),t("th",null,"Actions")])],-1)),t("tbody",null,[(u(!0),r(I,null,_(o.value,a=>(u(),r("tr",{key:a.id},[t("td",null,m(a.id),1),t("td",null,[t("img",{src:a.coverImage,alt:a.name,class:"thumb"},null,8,qe)]),t("td",null,m(a.name),1),t("td",null,m(a.type),1),t("td",null,m(a.range)+" km",1),t("td",null,[t("label",Qe,[t("input",{type:"checkbox",checked:a.enabled,onChange:l=>ge(a)},null,40,Xe),e[20]||(e[20]=t("span",{class:"slider"},null,-1))])]),t("td",Ze,[t("button",{class:"btn-edit",onClick:l=>he(a)},"Edit",8,et),t("button",{class:"btn-delete",onClick:l=>ke(a)},"Delete",8,tt)])]))),128))])])])),S.value?(u(),r("div",at,[t("h2",null,m(x.value?"Edit Vehicle":"Add New Vehicle"),1),A.value.length>0?(u(),r("div",nt,[e[28]||(e[28]=t("h3",{class:"db-selector-title"},"Quick Fill from Database",-1)),e[29]||(e[29]=t("p",{class:"db-selector-hint"},"Select brand, model and variant to auto-fill the form fields below.",-1)),t("div",st,[t("div",lt,[e[23]||(e[23]=t("label",null,"Brand",-1)),g(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>R.value=a),onChange:de},[e[22]||(e[22]=t("option",{value:""},"-- Select Brand --",-1)),(u(!0),r(I,null,_(A.value,a=>(u(),r("option",{key:a.nameEn,value:a.nameEn},m(a.nameEn),9,ot))),128))],544),[[B,R.value]])]),t("div",it,[e[25]||(e[25]=t("label",null,"Model",-1)),g(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>T.value=a),onChange:ce,disabled:!R.value},[e[24]||(e[24]=t("option",{value:""},"-- Select Model --",-1)),(u(!0),r(I,null,_(q(),a=>(u(),r("option",{key:a.nameEn,value:a.nameEn},m(a.nameEn),9,ut))),128))],40,rt),[[B,T.value]])]),t("div",dt,[e[27]||(e[27]=t("label",null,"Variant",-1)),g(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>F.value=a),disabled:!T.value},[e[26]||(e[26]=t("option",{value:""},"-- Select Variant --",-1)),(u(!0),r(I,null,_(ue(),a=>(u(),r("option",{key:a.specNameEn,value:a.specNameEn},m(a.specNameEn)+" ("+m(a.range)+"km) ",9,pt))),128))],8,ct),[[B,F.value]])]),t("button",{class:"btn-apply-variant",onClick:pe,disabled:!F.value}," Apply ",8,mt)])])):H.value?(u(),r("div",vt,[...e[30]||(e[30]=[t("p",{style:{"text-align":"center",color:"#999"}},"Loading brands database...",-1)])])):N("",!0),t("div",gt,[t("div",ft,[e[31]||(e[31]=t("label",null,"Name *",-1)),g(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>s.name=a),type:"text",placeholder:"e.g. 2025 BYD Song Plus"},null,512),[[k,s.name]])]),t("div",ht,[e[32]||(e[32]=t("label",null,"Slug *",-1)),g(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>s.slug=a),type:"text",placeholder:"e.g. song-plus"},null,512),[[k,s.slug]])]),t("div",yt,[e[34]||(e[34]=t("label",null,"Type *",-1)),g(t("select",{"onUpdate:modelValue":e[6]||(e[6]=a=>s.type=a)},[...e[33]||(e[33]=[_e('<option value="SUV" data-v-d882131e>SUV</option><option value="SEDAN" data-v-d882131e>SEDAN</option><option value="VAN" data-v-d882131e>VAN</option><option value="PICKUP" data-v-d882131e>PICKUP</option><option value="TRUCK" data-v-d882131e>TRUCK</option><option value="REFRIGERATED" data-v-d882131e>REFRIGERATED</option><option value="BUS" data-v-d882131e>BUS</option>',7)])],512),[[B,s.type]])]),t("div",bt,[e[35]||(e[35]=t("label",null,"Range (km) *",-1)),g(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>s.range=a),type:"number",placeholder:"e.g. 520"},null,512),[[k,s.range,void 0,{number:!0}]])]),t("div",wt,[e[36]||(e[36]=t("label",null,"Seats *",-1)),g(t("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>s.seats=a),type:"number",placeholder:"e.g. 5"},null,512),[[k,s.seats,void 0,{number:!0}]])]),t("div",Ct,[e[38]||(e[38]=t("label",null,"Configuration",-1)),g(t("select",{"onUpdate:modelValue":e[9]||(e[9]=a=>s.configuration=a)},[...e[37]||(e[37]=[t("option",{value:"Basic"},"Basic",-1),t("option",{value:"Premium"},"Premium",-1),t("option",{value:"Commercial"},"Commercial",-1)])],512),[[B,s.configuration]])]),t("div",kt,[e[39]||(e[39]=t("label",null,"Description",-1)),g(t("textarea",{"onUpdate:modelValue":e[10]||(e[10]=a=>s.description=a),rows:"4",placeholder:"Vehicle description..."},null,512),[[k,s.description]])])]),e[46]||(e[46]=t("h3",null,"Specifications",-1)),t("div",St,[t("div",$t,[e[40]||(e[40]=t("label",null,"Year",-1)),g(t("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>s.specs.year=a),type:"text",placeholder:"2025"},null,512),[[k,s.specs.year]])]),t("div",Et,[e[41]||(e[41]=t("label",null,"Make",-1)),g(t("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>s.specs.make=a),type:"text",placeholder:"BYD"},null,512),[[k,s.specs.make]])]),t("div",Ut,[e[42]||(e[42]=t("label",null,"Model",-1)),g(t("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>s.specs.model=a),type:"text",placeholder:"Song Plus"},null,512),[[k,s.specs.model]])]),t("div",xt,[e[43]||(e[43]=t("label",null,"Category",-1)),g(t("input",{"onUpdate:modelValue":e[14]||(e[14]=a=>s.specs.category=a),type:"text",placeholder:"PASSENGER"},null,512),[[k,s.specs.category]])]),t("div",Dt,[e[44]||(e[44]=t("label",null,"Battery Capacity",-1)),g(t("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>s.specs.batteryCapacity=a),type:"text",placeholder:"71.7 kWh"},null,512),[[k,s.specs.batteryCapacity]])])]),e[47]||(e[47]=t("h3",null,"Colors",-1)),t("div",Ft,[(u(!0),r(I,null,_(s.colors,(a,l)=>(u(),r("div",{key:l,class:"color-item"},[t("span",{class:"color-swatch",style:Ve({background:a})},null,4),t("span",null,m(oe(a)),1),t("button",{class:"btn-remove-sm",onClick:b=>s.colors.splice(l,1)},"x",8,It)]))),128)),t("div",_t,[g(t("select",{"onUpdate:modelValue":e[16]||(e[16]=a=>V.value=a)},[e[45]||(e[45]=t("option",{value:""},"-- Select Color --",-1)),(u(!0),r(I,null,_(ie(),a=>(u(),r("option",{key:a.hex,value:a.hex},m(a.name),9,Vt))),128))],512),[[B,V.value]]),t("button",{class:"btn-add-color",onClick:re,disabled:!V.value},"+ Add",8,At)])]),e[48]||(e[48]=t("h3",null,"Cover Image",-1)),t("div",Tt,[s.coverImage?(u(),r("div",Nt,[t("img",{src:s.coverImage,alt:"Cover",class:"preview-img"},null,8,Bt)])):N("",!0),t("input",{type:"file",accept:"image/*",onChange:be,ref_key:"coverInput",ref:se},null,544)]),e[49]||(e[49]=t("h3",null,"Detail Images",-1)),t("div",Rt,[t("div",jt,[(u(!0),r(I,null,_(s.detailImages,(a,l)=>(u(),r("div",{key:l,class:"detail-img-item"},[t("img",{src:a,alt:"Detail",class:"preview-img-sm"},null,8,Pt),t("button",{class:"btn-remove-sm",onClick:b=>Ce(l)},"x",8,Lt)]))),128))]),t("input",{type:"file",accept:"image/*",multiple:"",onChange:we,ref_key:"detailInput",ref:le},null,544)]),t("div",Ot,[t("button",{class:"btn-save",onClick:$e,disabled:P.value},m(P.value?"Saving...":"Save"),9,Mt),t("button",{class:"btn-cancel",onClick:ye},"Cancel")])])):N("",!0)])):(u(),r("div",Re,[t("div",je,[e[17]||(e[17]=t("h1",null,"TG Automobile Admin",-1)),e[18]||(e[18]=t("p",{class:"login-desc"},"Enter your GitHub Personal Access Token to manage vehicles.",-1)),t("div",Pe,[g(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),type:"password",placeholder:"GitHub Personal Access Token",onKeyup:Fe(Z,["enter"])},null,544),[[k,c.value]]),t("button",{onClick:Z,disabled:h.value},m(h.value?"Verifying...":"Login"),9,Le),v.value?(u(),r("p",Oe,m(v.value),1)):N("",!0)])])]))]))}},Kt=Ae(Gt,[["__scopeId","data-v-d882131e"]]);export{Kt as default};
